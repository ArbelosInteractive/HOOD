
import os
os.environ["HOOD_PROJECT"] = "/home/sethclim/coding/HOOD"
os.environ["HOOD_DATA"] = "/mnt/c/Users/sethc/coding/arbelos/hood_data"

HOOD_PROJECT = os.environ["HOOD_PROJECT"]
HOOD_DATA = os.environ["HOOD_DATA"]
VTO_DATASET_PATH = '/mnt/c/Users/sethc/coding/arbelos/vto-dataset'

from pathlib import Path
from utils.data_making import convert_vto_to_pkl
from utils.validation import Config as ValidationConfig
from utils.validation import load_runner_from_checkpoint, update_config_for_validation, create_one_sequence_dataloader
from utils.arguments import load_params
from utils.common import move2device, pickle_dump
from utils.defaults import DEFAULTS
from pathlib import Path

from utils.mesh_creation import add_garment_to_garments_dict, add_pinned_verts
from utils.defaults import DEFAULTS

from utils.show import write_video 
from aitviewer.headless import HeadlessRenderer

def main():
    print(f"HOOD_PROJECT {HOOD_PROJECT} HOOD_DATA {HOOD_DATA}")


    vto_sequence_path = Path(VTO_DATASET_PATH) / 'tshirt/simulations/tshirt_shape00_01_01.pkl'
    target_pkl_path =  Path(HOOD_DATA) / 'temp/01_01.pkl'


    convert_vto_to_pkl(vto_sequence_path, target_pkl_path, n_zeropose_interpolation_steps=30)
    print(f'Pose sequence saved into {target_pkl_path}')

        
    garment_obj_path = os.path.join(DEFAULTS.aux_data, 'garment_meshes', 'on-large-welded', 'on-large-welded.obj')
    smpl_file = os.path.join(DEFAULTS.aux_data, 'smpl', 'SMPL_FEMALE.pkl')
    garments_dict_path = os.path.join(DEFAULTS.aux_data, 'garments_dict.pkl')

    # Name of the garment we are adding
    garment_name = 'novel_tank'

    # add_garment_to_garments_dict(garment_obj_path, garments_dict_path, garment_name, smpl_file=smpl_file, n_samples_lbs=300, verbose=True)

    # pinned_indices = [796, 797, 798, 946, 1898, 1899, 1968, 1969, 1970, 1971, 1972, 1973, 1976, 2246, 2247, 2248, 2249, 2251, 2252, 2253, 2268, 2269, 2270, 2313, 2314, 2317, 2703, 3139, 3140, 3141, 3142, 3145, 3146, 3147, 3148, 3149, 3150, 3151, 3152, 3190, 3191, 3192, 3195, 3199, 3200, 3201, 3202, 3203, 3204, 3374, 3375, 3376, 3377, 3378, 4620, 4961, 5793, 9609, 9610, 9611, 9615, 9616, 9617, 9627, 9628, 9629, 9633, 9634, 9637, 9638, 9639, 9640, 9641, 9685, 9686, 9707, 9708, 9709, 9719, 9720, 9721, 9729, 9730, 9894, 9895, 9896, 9922, 9923, 9924, 9949, 9950, 9951, 9952, 9953, 9954, 9962, 9963, 9966, 9969, 9970, 9971, 9972, 9973, 9974, 10013, 10014, 10015, 10047, 10048, 10049, 10055, 10056, 10057, 10058, 10059, 10060, 10095, 10096, 10129, 10130, 10131, 10144, 10145, 10146, 10150, 10151, 10152, 10163, 10164, 10192, 10193, 10194, 10212, 10213, 10214, 10236, 10237, 10238, 10240, 10241, 10275, 10276, 10277, 10295, 10296, 10297, 10298, 10299, 10300, 10312, 10313, 10314, 10327, 10328, 10329, 10404, 10470, 10471, 10472, 10498, 10514, 10516, 10525, 10526, 10527, 10545, 10546, 10547, 10582, 10700, 10702, 10704, 10705, 10706, 10722, 10723, 10725, 10726, 10727, 10732, 10733, 10734, 10737, 10738, 10739, 10740, 10745, 10746, 10747, 10748, 10749, 10750, 10751, 10752, 10753, 10755, 10756, 10757, 10758, 10759, 10760, 10763, 10764, 10765, 10766, 10767, 10768, 10769, 10770, 10771, 10772, 10773, 10774, 10775, 10776, 10781, 10782, 10783, 10784, 10785, 10786, 10787, 10788, 10789, 10790, 10791, 10792, 10793, 10794, 10797, 10800, 10801, 10804, 10805, 10806, 10807, 10808, 10809, 10810, 10811, 10812, 10813, 10814, 10815, 10816, 10817, 10818, 10819, 10820, 10821, 10822, 10823, 10824, 10825, 10826, 10827, 10828, 10829, 10832, 10833, 10834, 10835, 10841, 10842, 10850, 10851, 10883, 10891, 10892, 10895, 10896, 10897, 10901, 10902, 10904, 10905, 10906, 10907, 10908, 10909, 10910, 10911, 10912, 10913, 10914, 10915, 10916, 10917, 10918, 10919, 10920, 10921, 10922, 10923, 10924, 10925, 10926, 10928, 10929, 10933, 10934, 10935, 10942, 10943, 10944, 10945, 10949, 10950, 10951, 10952, 10958, 10959, 10960, 10961, 10963, 10964, 10967, 10968, 10969, 10970, 10971, 10972, 10973, 10974, 10975, 10976, 10977, 10978, 10979, 10980, 10981, 10982, 10983, 10984, 10985, 10989, 10990, 10991, 10994, 10995, 10996, 10997, 10998, 10999, 11000, 11006, 11007, 11013, 11014, 11015, 11016, 11020, 11024, 11025, 11026, 11027, 11028, 11029, 11030, 11031, 11032, 11033, 11034, 11035, 11036, 11037, 11038, 11039, 11040, 11041, 11042, 11043, 11044, 11045, 11046, 11047, 11048, 11049, 11050, 11051, 11052, 11053, 11054, 11055, 11056, 11057, 11061, 11066, 11067, 11068, 11069, 11070, 11071, 11072, 11073, 11074, 11075, 11076, 11077, 11078, 11079, 11081, 11082, 11085, 11087, 11091, 11095, 11101, 11104, 11105, 11106, 11107, 11108, 11111, 11134, 11274, 11281, 11282, 11283, 11295, 11296, 11297, 11303, 11304, 11305, 11306, 11307, 11309, 11310, 11311, 11312, 11313, 11314, 11315, 11316, 11317, 11318, 11319, 11320, 11321, 11322, 11323, 11324, 11325, 11326, 11327, 11328, 11329, 11330, 11331, 11332, 11333, 11334, 11335, 11336, 11337, 11338, 11339, 11340, 11341, 11342, 11343, 11344, 11345, 11346, 11348, 11349, 11350, 11351, 11352, 11353, 11354, 11356, 11357, 11358, 11359, 11360, 11361, 11362, 11363, 11364, 11365, 11366, 11367, 11368, 11369, 11370, 11371, 11372, 11373, 11374, 11375, 11376, 11378, 11379, 11381, 11382, 11383, 11385, 11399, 11400, 11401, 11402, 11403, 11404, 11405, 11409, 11410, 11411, 11420, 11421, 11422, 11423, 11424, 11425, 11426, 11427, 11429, 11430, 11431, 11432, 11436, 11437, 11438, 11439, 11440, 11441, 11442, 11443, 11444, 11445, 11446, 11447, 11448, 11449, 11450, 11451, 11452, 11457, 11458, 11461, 11464, 11467, 11471, 11472, 11475, 11476, 11477, 11478, 11479, 11480, 11481, 11486, 11487, 11488, 11505, 11506, 11507, 11508, 11622, 11631, 11632, 11633, 11640, 11641, 11642, 11669, 11679, 11753, 11754, 11755, 11764, 11835, 11836, 11837, 11838, 11839, 11872, 11873, 11874, 11889, 11912, 12076, 12077, 12078, 12081, 12082, 12083, 12110, 12111, 12112, 12115, 12116, 12138, 12139, 12166, 12167, 12168, 12217, 12218, 12219, 12224, 12228, 12234, 12235, 12236, 12385, 12386, 12392, 12419, 12420, 12421, 12423, 12424, 12425, 12426, 12427, 12428, 12429, 12430, 12431, 12432, 12438, 12439, 12440, 12441, 12442, 12443, 12444, 12446, 12447, 12448, 12449, 12450, 12451, 12452, 12453, 12454, 12456, 12457, 12458, 12459, 12460, 12461, 12462, 12463, 12464, 12465, 12466, 12468, 12469, 12470, 12471, 12472, 12473, 12474, 12475, 12476, 12477, 12478, 12479, 12480, 12481, 12482, 12485, 12486, 12487, 12488, 12489, 12490, 12491, 12492, 12494, 12495, 12496, 12497, 12498, 12499, 12500, 12503, 12504, 12505, 12506, 12507, 12508, 12509, 12510, 12511, 12512, 12513, 12514, 12515, 12516, 12517, 12518, 12519, 12520, 12521, 12522, 12523, 12524, 12525, 12526, 12527, 12528, 12557, 12558, 12561, 12562, 12563, 12564, 12565, 12566, 12567, 12568, 12569, 12570, 12571, 12572, 12573, 12574, 12575, 12576, 12577, 12578, 12579, 12580, 12581, 12582, 12583, 12584, 12585, 12586, 12587, 12588, 12589, 12590, 12591, 12592, 12593, 12594, 12595, 12596, 12597, 12598, 12599, 12601, 12602, 12605, 12608, 12609, 12610, 12611, 12612, 12613, 12614, 12615, 12616, 12617, 12618, 12620, 12622, 12624, 12625, 12626, 12627, 12628, 12629, 12632, 12636, 12637, 12638, 12639, 12640, 12641, 12642, 12643, 12644, 12645, 12646, 12647, 12648, 12649, 12650, 12651, 12652, 12653, 12654, 12655, 12656, 12657, 12658, 12659, 12660, 12661, 12662, 12669, 12670, 12671, 12672, 12673, 12674, 12675, 12676, 12678, 12679, 12683, 12684, 12685, 12686, 12687, 12688, 12689, 12690, 12691, 12692, 12693, 12694, 12695, 12696, 12697, 12702, 12703, 12704, 12705, 12706, 12707, 12708, 12709, 12710, 12711, 12712, 12713, 12714, 12715, 12716, 12717, 12718, 12719, 12720, 12721, 12722, 12723, 12724, 12725, 12726, 12727, 12728, 12732, 12733, 12734, 12735, 12736, 12738, 12739, 12740, 12741, 12742, 12743, 12744, 12745, 12746, 12747, 12748, 12749, 12750, 12751, 12752, 12753, 12754, 12755, 12756, 12757, 12758, 12759, 12760, 12761, 12762, 12763, 12767, 12768, 12769, 12770, 12771, 12774, 12775, 12778, 12779, 12784, 12799, 12897, 12989, 12990, 12991, 12992, 13059, 13097, 13098, 13099, 13100, 13215, 13470, 13471, 13472, 13473, 13474, 13475, 13476, 13477, 13478, 13479, 13480, 13481, 13482, 13483, 13484, 13485, 13486, 13487, 13502, 13503, 13504, 13505, 13506, 13507, 13508, 13509, 13510, 13511, 13513, 13514, 13515, 13516, 13517, 13572, 13790, 13973, 13987, 13988, 13989, 13990, 13993, 13994, 14018, 14019, 14020, 14021, 14022, 14023, 14024, 14025, 14026, 14027, 14028, 14029, 14030, 14031, 14032, 14033, 14034, 14035, 14036, 14037, 14038, 14039, 14048, 14049, 14050, 14051, 14052, 14053, 14059, 14060, 14074, 14075, 14076, 14086, 14100, 14101, 14102, 14112, 14114, 14115, 14116, 14186, 14187, 14188, 14213, 14214, 14215, 14301, 14302, 14303, 14310, 14311, 14312, 14380, 14381, 14382, 14386, 14387, 14388, 14394, 14395, 14396, 14441, 14442, 14483, 14492, 14493, 14494, 14497, 14498, 14499, 14512, 14513, 14514, 14518, 14519, 14520, 14521, 14522, 14523, 14541, 14546, 14547, 14551, 14562, 14563, 14564, 14583, 14584, 14585, 14589, 14590, 14595, 14598, 14599, 14600, 14601, 14602, 14606, 14610, 14611, 14612, 14613, 14614, 14615, 14618, 14619, 14620, 14621, 14622, 14624, 14625, 14626, 14631, 14632, 14633, 14634, 14635, 14636, 14641, 14642, 14643, 14644, 14645, 14647, 14648, 14649, 14652, 14653, 14654, 14657, 14658, 14660, 14661, 14668, 14670, 14671, 14672, 14676, 14677, 14678, 14693, 14694, 14695, 14696, 14697, 14698, 14699, 14700, 14703, 14704, 14705, 14706, 14709, 14710, 14711, 14715, 14716, 14717, 14718, 14721, 14724, 14725, 14727, 14728, 14729, 14730, 14731, 14732, 14735, 14736, 14739, 14741, 14743, 14744, 14745, 14747, 14748, 14750, 14752, 14753, 14754, 14755, 14756, 14757, 14758, 14759, 14760, 14761, 14762, 14763, 14764, 14765, 14766, 14767, 14768, 14769, 14770, 14771, 14774, 14775, 14777, 14779, 14780, 14781, 14782, 14783, 14784, 14785, 14786, 14787, 14788, 14789, 14790, 14791, 14792, 14793, 14794, 14795, 14796, 14797, 14800, 14801, 14803, 14805, 14806, 14807, 14809, 14810, 14812, 14815, 14816, 14817, 14821, 14822, 14823, 14824, 14825, 14826, 14827, 14829, 14830, 14831, 14832, 14833, 14834, 14837, 14838, 14839, 14840, 14841, 14842, 14843, 14844, 14849, 14850, 14851, 14852, 14853, 14854, 14855, 14856, 14857, 14858, 14859, 14862, 14865, 14866, 14955, 14961, 14962, 14963, 14978, 14979, 15036, 15037, 15038, 15073, 15074, 15075, 15079, 15080, 15081, 15082, 15084, 15085, 15086, 15093, 15094, 15095, 15096, 15097, 15098, 15099, 15103, 15106, 15107, 15113, 15114, 15115, 15116, 15139, 15188, 15189, 15190, 15195, 15196, 15197, 15200, 15208, 15212, 15213, 15221, 15226, 15227, 15228, 15231, 15232, 15233, 15234, 15235, 15236, 15237, 15249, 15250, 15251, 15252, 15255, 15256, 15257, 15258, 15259, 15260, 15261, 15263, 15264, 15279, 15288, 15298, 15299, 15300, 15306, 15307, 15308, 15323, 15339, 15340, 15343, 15344, 15348, 15351, 15380, 15384, 15386, 15387, 15393, 15400, 15401, 15405, 15408, 15533, 15534, 15535, 15536, 15537, 15538, 15539, 15604, 15605, 15606, 15607, 15608, 15609, 15610, 15611, 15612, 15613, 15614, 15615, 15616, 15617, 15618, 15619, 15620, 15621, 15622, 15623, 15624, 15625, 15626, 15627, 15628, 15629, 15630, 15631, 15632, 15633, 15634, 15635, 15636, 15643, 15644, 15646, 15647, 15648, 15649, 15650, 15651, 15727, 15728, 15754, 15755, 15756, 15757, 15769, 15770, 15771, 15772, 15773, 15775, 15792, 15793, 15800, 15801, 15820, 15821, 15822, 15836, 15837, 15838, 15839, 15840, 15841, 15842, 15846, 15847, 15848, 18573, 18574, 18575, 18576, 18577, 18578, 18697, 18698, 18699, 18819, 18823, 18824, 18825, 18827, 18829, 18871, 18872, 19009, 19010, 19011, 19012, 19133, 19136, 19137, 19138, 19146, 19147, 19148, 19151, 19152, 19153, 19190, 19192, 19194, 19195, 19196, 19200, 19201, 19202, 19203, 19204, 19205, 19209, 19210, 19211, 19212, 19213, 19214, 19216, 19220, 19221, 19222, 19223, 19224, 19232, 19234, 19235, 19236, 19237, 19238, 19239, 19240, 19241, 19245, 19246, 19247, 19249, 19250, 19251, 19253, 19254, 19255, 19308, 19309, 19310, 19311, 19314, 19315, 19316, 19325, 19326, 19327, 19394, 19397, 19404, 19405, 19411, 19412, 19413, 19423, 19424, 19492, 19494, 19495, 19496, 19497, 19498, 19499, 19500, 19501, 19502, 19504, 19505, 19506, 19507, 19510, 19514, 19515, 19516, 19517, 19518, 19519, 19520, 19521, 19523, 19541, 19542, 19543, 19548, 19549, 19551, 19552, 19553, 19555, 19556, 19557, 19558, 19559, 19560, 19561, 19562, 19563, 19564, 19565, 19566, 19567, 19568, 19569, 19570, 19571, 19576, 19577, 19578, 19581, 19582, 19585, 19586, 19589, 19590, 19591, 19593, 19594, 19595, 19596, 19599, 19601, 19602, 19603, 19605, 19608, 19609, 19610, 19611, 19613, 19614, 19615, 19616, 19617, 19618, 19620, 19622, 19623, 19627, 19631, 19634, 19635, 19636, 19637, 19639, 19640, 19641, 19644, 19645, 19646, 19647, 19649, 19650, 19651, 19653, 19654, 19658, 19660, 19661, 19662, 19666, 19667, 19668, 19670, 19671, 19672, 19673, 19674, 19677, 19678, 19679, 19680, 19681, 19688, 19689, 19693, 19698, 19699, 19700, 19702, 19703, 19704, 19705, 19706, 19710, 19711, 19713, 19714, 19723, 19727, 19731, 19732, 19733, 19781, 19782, 19783, 19784, 19785, 19786, 19787, 19788, 19789, 19790, 19791, 19792, 19793, 19794, 19795, 19796, 19797, 19798, 19799, 19800, 19801, 19802, 19803, 19804, 19805, 19806, 19807, 19808, 19809, 19810, 19811, 19812, 19813, 19814, 19815, 19816, 19817, 19818, 19819, 19820, 19821, 19822, 19823, 19824, 19825, 19826, 19827, 19828, 19829, 19830, 19831, 19832, 19833, 19834, 19835, 19836, 19837, 19840, 19845, 19846, 19847, 19848, 19849, 19850, 19851, 19852, 19853, 19985, 19986, 19987, 19989, 19990, 19991, 19992, 19993, 19994, 19995, 19996, 20055, 20056, 20057, 20058, 20059, 20060, 20061, 20062, 20063, 20064, 20065, 20066, 20067, 20068, 20069, 20070, 20071, 20072, 20073, 20074, 20075, 20076, 20079, 20080, 20081, 20082, 20083, 20114, 20115, 20116, 20117, 20118, 20119, 20120, 20121, 20122, 20144, 20152, 20153, 20154, 20170, 20171, 20172, 20174, 20175, 20180, 22838, 22839, 22840, 22862, 22863, 22864, 22946, 22947, 22948, 22961, 22962, 23039, 23040, 23041, 23105, 23106, 23107, 23152, 23153, 23154, 23160, 23180, 23181, 23182, 23194, 23195, 23196, 23204, 23205, 23206, 23211, 23212, 23213, 23228, 23229, 23230, 23246, 23253, 23254, 23259, 23260, 23263, 23264, 23268, 23269, 23270, 23271, 23272, 23275, 23276, 23277, 23278, 23279, 23281, 23282, 23283, 23284, 23285, 23291, 23292, 23293, 23294, 23295, 23296, 23297, 23300, 23302, 23303, 23304, 23305, 23306, 23307, 23311, 23312, 23313, 23315, 23316, 23320, 23321, 23322, 23324, 23325, 23326, 23329, 23330, 23361, 23365, 23366, 23367, 23368, 23369, 23370, 23377, 23378, 23379, 23385, 23390, 23398, 23400, 23404, 23405, 23407, 23408, 23413, 23414, 23415, 23416, 23417, 23418, 23419, 23420, 23421, 23422, 23423, 23424, 23425, 23426, 23427, 23428, 23433, 23434, 23436, 23438, 23439, 23440, 23441, 23442, 23443, 23444, 23445, 23446, 23448, 23449, 23450, 23451, 23452, 23455, 23456, 23457, 23458, 23461, 23462, 23468, 23469, 23470, 23471, 23475, 23476, 23477, 23478, 23484, 23485, 23487, 23488, 23489, 23490, 23491, 23492, 23493, 23494, 23495, 23496, 23497, 23499, 23500, 23501, 23502, 23503, 23507, 23508, 23509, 23510, 23512, 23513, 23518, 23519, 23520, 23621, 23622, 23640, 23642, 23734, 23735, 23736, 23741, 23821, 23822, 23825, 23826, 23829, 23830, 23831, 23833, 23834, 23843, 23853, 23854, 23855, 23856, 23858, 23859, 23860, 23862, 23863, 23864, 23867, 23881, 23882, 23883, 23884, 23885, 23886, 23887, 23888, 23897, 23908, 23914, 23923, 23924, 23925, 23930, 23931, 23932, 23933, 23934, 23935, 23938, 23939, 23940, 23947, 23948, 23949, 23958, 23959, 23960, 23980, 23981, 23982, 23983, 23987, 23988, 23990, 23996, 23997, 24040, 24043, 24155, 24156, 24157, 24158, 24159, 24160, 24161, 24162, 24163, 24164, 24165, 24233, 24234, 24235, 24236, 24237, 24238, 24239, 24240, 24241, 24242, 24243, 24245, 24246, 24247, 24248, 24249, 24250, 24251, 24252, 24253, 24263, 24264, 24265, 24266, 24267, 24268, 24269, 24270, 24271, 24272, 24273, 24286, 24287, 24288, 24401, 24402, 24403, 24404, 24405, 24415, 24416, 24417, 24418, 24419, 24420, 24421, 24423, 24425, 24426, 24427, 24428, 24430, 24431, 24448, 24452, 24453, 24454, 24455, 24457, 24458, 24476, 24477, 24615, 24616, 24617, 24618, 24619, 24620, 24741, 24742, 24743, 24861, 24865, 24866, 24867, 24869, 24871, 24911, 24912, 25045, 25046, 25047, 25048, 25172, 25175, 25176, 25177, 25185, 25186, 25187, 25188, 25189, 25190, 25232, 25233, 25234, 25238, 25239, 25240, 25241, 25242, 25243, 25247, 25248, 25249, 25250, 25251, 25252, 25253, 25254, 25258, 25260, 25261, 25262, 25263, 25264, 25274, 25277, 25278, 25279, 25280, 25281, 25282, 25283, 25284, 25288, 25289, 25290, 25292, 25294, 25295, 25296, 25350, 25351, 25352, 25354, 25355, 25356, 25359, 25370, 25371, 25372, 25433, 25438, 25441, 25448, 25456, 25457, 25459, 25466, 25489, 25490, 25491, 25496, 25529, 25531, 25532, 25533, 25534, 25535, 25536, 25537, 25538, 25539, 25542, 25543, 25544, 25547, 25551, 25552, 25553, 25554, 25555, 25556, 25557, 25558, 25562, 25563, 25564, 25565, 25574, 25575, 25578, 25579, 25580, 25581, 25582, 25583, 25590, 25591, 25593, 25594, 25595, 25597, 25598, 25599, 25600, 25601, 25602, 25603, 25604, 25605, 25606, 25607, 25608, 25609, 25610, 25611, 25612, 25613, 25618, 25619, 25620, 25621, 25622, 25624, 25625, 25630, 25631, 25632, 25633, 25634, 25635, 25636, 25640, 25642, 25643, 25644, 25646, 25649, 25650, 25651, 25652, 25657, 25658, 25659, 25660, 25662, 25663, 25664, 25666, 25667, 25671, 25673, 25676, 25677, 25678, 25679, 25681, 25682, 25683, 25685, 25686, 25687, 25688, 25690, 25691, 25692, 25693, 25694, 25697, 25699, 25700, 25701, 25705, 25706, 25707, 25709, 25710, 25711, 25712, 25713, 25716, 25717, 25718, 25719, 25720, 25727, 25728, 25731, 25740, 25741, 25742, 25744, 25745, 25746, 25747, 25748, 25751, 25752, 25753, 25754, 25755, 25756, 25762, 25768, 25770, 25773, 25774, 25790, 25791, 25792, 25819, 25820, 25821, 25822, 25823, 25824, 25825, 25826, 25827, 25828, 25829, 25830, 25831, 25832, 25833, 25834, 25835, 25836, 25837, 25838, 25839, 25840, 25841, 25842, 25843, 25844, 25845, 25846, 25847, 25848, 25849, 25850, 25851, 25852, 25853, 25854, 25855, 25856, 25857, 25858, 25859, 25860, 25861, 25862, 25863, 25864, 25865, 25866, 25867, 25868, 25869, 25870, 25871, 25872, 25873, 25874, 25875, 25876, 25877, 25878, 25879, 25880, 25881, 25882, 25883, 25884, 25885, 25886, 25887, 25888, 25889, 25890, 25891, 26023, 26024, 26027, 26028, 26029, 26030, 26031, 26032, 26033, 26034, 26097, 26098, 26099, 26100, 26101, 26102, 26103, 26104, 26105, 26106, 26107, 26108, 26109, 26110, 26111, 26112, 26113, 26114, 26115, 26116, 26117, 26118, 26119, 26120, 26121, 26122, 26123, 26124, 26125, 26157, 26158, 26159, 26181, 26187, 26188, 26189, 26190, 26191, 26207, 26208, 26209, 26211, 26212, 26213, 26218, 29312, 29313, 29314, 29393, 29394, 29400, 29401, 29402, 29485, 29486, 29494, 29495, 29496, 29499, 29926, 29928, 29932, 29933, 29937, 29939, 29940, 29941, 29942, 29947, 29948, 29949, 29950, 29951, 29980, 29982, 29984, 29985, 29986, 29987, 29993, 30038, 30056, 30137, 30139, 30145, 30146, 30177, 30178, 30179, 30257, 30259, 30260, 30261, 30263, 30266, 30318, 30319, 30320, 30325, 30351, 30359, 30377, 30379, 30398, 30406, 30407, 30480, 30577, 30582, 30583, 30584, 30585, 30735, 30746, 30747, 30748, 30756, 30757, 30760, 30761, 30763, 30793, 30938, 30943, 30944, 30945, 30946, 30947, 30948, 30949, 31084, 31085, 31089, 31209, 31210, 31237, 31268, 31339, 31340, 31341, 31342, 31364, 31365, 31366, 31367, 31368, 31375, 31376, 31377, 31386, 31387, 31424, 31425, 31426, 31427, 31428, 31429, 31433, 31434, 31435, 31437, 31438, 31439, 31455, 31456, 31457, 31458, 31459, 31460, 31467, 31468, 31469, 31472, 31473, 31474, 31477, 31478, 31479, 31480, 31485, 31486, 31487, 31488, 31489, 31490, 31491, 31498, 31499, 31500, 31503, 31504, 31505, 31506, 31510, 31561, 31564, 31565, 31566, 31567, 31570, 31673, 31677, 31679, 31680, 31681, 31722, 31723, 31724, 31740, 31751, 31753, 31754, 31755, 31765, 31766, 31767, 31779, 31784, 31785, 31786, 31787, 31788, 31789, 31793, 31794, 31795, 31796, 31797, 31799, 31800, 31801, 31802, 31803, 31804, 31805, 31806, 31807, 31808, 31809, 31810, 31811, 31812, 31813, 31814, 31815, 31816, 31817, 31818, 31819, 31820, 31821, 31822, 31823, 31824, 31825, 31826, 31828, 31829, 31830, 31831, 31832, 31833, 31834, 31835, 31836, 31837, 31838, 31839, 31840, 31841, 31842, 31843, 31844, 31845, 31846, 31847, 31848, 31849, 31850, 31851, 31852, 31853, 31854, 31855, 31856, 31857, 31858, 31859, 31860, 31861, 31862, 31863, 31864, 31865, 31866, 31867, 31868, 31869, 31876, 31879, 31881, 31882, 31883, 31884, 31885, 31886, 31887, 31888, 31889, 31890, 31891, 31892, 31893, 31894, 31895, 31896, 31897, 31898, 31899, 31900, 31901, 31902, 31903, 31904, 31905, 31906, 31908, 31909, 31910, 31911, 31912, 31913, 31914, 31915, 31916, 31917, 31921, 31922, 31923, 31924, 31925, 31926, 31927, 31929, 31930, 31931, 31932, 31933, 31934, 31935, 31940, 31941, 31945, 31946, 31947, 31949, 31950, 31951, 31952, 31953, 31955, 31956, 31957, 31958, 31965, 31966, 31967, 31968, 31971, 31972, 31973, 31974, 31975, 31976, 31977, 31978, 31979, 31980, 31981, 31982, 31983, 31984, 31985, 31986, 31987, 31988, 31989, 31990, 31991, 31992, 31993, 31994, 31995, 31996, 31997, 31998, 31999, 32000, 32001, 32002, 32003, 32004, 32005, 32006, 32007, 32008, 32009, 32010, 32011, 32012, 32013, 32014, 32015, 32016, 32017, 32018, 32019, 32020, 32021, 32022, 32023, 32024, 32025, 32026, 32027, 32028, 32029, 32030, 32031, 32032, 32033, 32034, 32035, 32036, 32037, 32038, 32039, 32040, 32041, 32042, 32043, 32044, 32045, 32046, 32047, 32048, 32049, 32050, 32051, 32052, 32053, 32054, 32055, 32056, 32057, 32058, 32059, 32060, 32061, 32062, 32063, 32064, 32065, 32066, 32067, 32068, 32069, 32070, 32071, 32072, 32073, 32074, 32075, 32076, 32077, 32078, 32079, 32080, 32081, 32082, 32083, 32084, 32085, 32086, 32087, 32088, 32089, 32090, 32091, 32092, 32093, 32094, 32095, 32096, 32097, 32098, 32099, 32100, 32101, 32102, 32103, 32107, 32116, 32117, 32118, 32119, 32120, 32121, 32122, 32123, 32124, 32125, 32126, 32127, 32128, 32130, 32134, 32135, 32142, 32143, 32146, 32147, 32153, 32154, 32155, 32156, 32157, 32158, 32159, 32160, 32161, 32162, 32163, 32167, 32168, 32169, 32208, 32209, 32267, 32268, 32308, 32310, 32318, 32319, 32332, 32333, 32339, 32397, 32402, 32403, 32405, 32406, 32407, 32412, 32413, 32414, 32416, 32418, 32419, 32420, 32421, 32422, 32423, 32424, 32427, 32428, 32432, 32433, 32437, 32438, 32439, 32440, 32441, 32442, 32443, 32444, 32445, 32447, 32448, 32449, 32450, 32451, 32452, 32453, 32454, 32455, 32456, 32457, 32458, 32459, 32460, 32461, 32462, 32463, 32464, 32465, 32466, 32467, 32468, 32469, 32470, 32471, 32472, 32473, 32474, 32475, 32476, 32477, 32478, 32479, 32480, 32481, 32482, 32483, 32484, 32485, 32486, 32487, 32488, 32489, 32490, 32491, 32492, 32493, 32494, 32495, 32496, 32497, 32498, 32499, 32500, 32501, 32502, 32503, 32504, 32505, 32506, 32507, 32508, 32509, 32510, 32511, 32513, 32514, 32515, 32517, 32518, 32522, 32523, 32527, 32528, 32529, 32532, 32533, 32534, 32535, 32536, 32537, 32538, 32539, 32540, 32541, 32542, 32544, 32545, 32546, 32547, 32548, 32549, 32550, 32551, 32555, 32556, 32559, 32560, 32561, 32562, 32563, 32566, 32567, 32568, 32569, 32570, 32571, 32572, 32573, 32574, 32575, 32576, 32577, 32578, 32579, 32580, 32581, 32582, 32583, 32584, 32585, 32586, 32587, 32588, 32589, 32591, 32592, 32593, 32594, 32595, 32596, 32598, 32599, 32600, 32602, 32603, 32604, 32605, 32606, 32607, 32608, 32609, 32611, 32613, 32614, 32615, 32620, 32621, 32622, 32623, 32624, 32625, 32628, 32629, 32630, 32631, 32632, 32634, 32635, 32636, 32637, 32638, 32639, 32640, 32641, 32642, 32643, 32644, 32645, 32649, 32651, 32655, 32656, 32657, 32659, 32660, 32661, 32662, 32665, 32666, 32667, 32670, 32671, 32672, 32674, 32675, 32676, 32677, 32678, 32680, 32681, 32682, 32683, 32684, 32685, 32686, 32687, 32688, 32689, 32690, 32691, 32692, 32693, 32694, 32695, 32697, 32698, 32699, 32700, 32701, 32702, 32703, 32704, 32705, 32706, 32707, 32709, 32710, 32711, 32712, 32713, 32714, 32715, 32716, 32717, 32718, 32719, 32720, 32721, 32722, 32723, 32724, 32725, 32726, 32727, 32728, 32729, 32730, 32731, 32732, 32733, 32734, 32735, 32736, 32737, 32738, 32739, 32740, 32741, 32742, 32743, 32744, 32745, 32746, 32747, 32748, 32749, 32750, 32751, 32752, 32753, 32754, 32755, 32756, 32757, 32758, 32759, 32760, 32761, 32762, 32763, 32764, 32765, 32805, 32807, 32810, 32834, 32835, 32836, 32837, 32838, 32839, 32840, 32841, 32842, 32843, 32844, 32845, 32846, 32847, 32848, 32849, 32850, 32851, 32852, 32853, 32854, 32855, 32856, 32857, 32858, 32859, 32860, 32861, 32862, 32863, 32864, 32865, 32866, 32867, 32868, 32869, 32870, 32871, 32872, 32873, 32874, 32875, 32876, 32877, 32878, 32879, 32880, 32881, 32882, 32883, 32884, 32885, 32886, 32887, 32888, 32889, 32890, 32891, 32892, 32953, 32954, 32955, 32956, 32957, 32958, 32959, 32960, 32961, 32962, 32963, 32964, 32965, 32966, 32967, 32968, 32969, 32970, 32971, 32972, 32973, 32974, 32975, 32976, 32977, 32978, 32979, 32980, 32981, 32982, 32983, 32984, 32985, 32986, 32987, 32988, 32989, 32990, 32991, 32992, 32993, 32994, 32995, 32996, 32997, 32998, 32999, 33000, 33001, 33002, 33003, 33018, 33019, 33020, 33021, 33022, 33023, 33024, 33038, 33039, 33040, 33041, 33053, 33054, 33055, 33056, 33057, 33058, 33059, 33060, 33061, 33062, 33063, 33064, 33065, 33066, 33067, 33068, 33069, 33070, 33071, 33076, 33077, 33078, 33079, 33083, 33084, 33089, 33090, 33091, 33093, 33101, 33102, 33103, 33104, 33105, 33106, 33107, 33108, 33109, 33110, 33130, 33131, 33132, 33133, 33134, 33135, 33136, 33137, 33138, 33139, 33192, 33193, 33194, 33278, 33279, 33280, 33369, 33370, 33372, 33375, 33799, 33800, 33802, 33803, 33804, 33811, 33812, 33813, 33822, 33855, 33856, 33860, 33862, 33863, 33908, 33912, 33929, 33930, 34009, 34013, 34016, 34020, 34021, 34059, 34060, 34155, 34168, 34169, 34170, 34250, 34255, 34256, 34263, 34264, 34265, 34266, 34288, 34446, 34447, 34450, 34455, 34456, 34457, 34458, 34459, 34460, 34468, 34469, 34470, 34530, 34531, 34532, 34620, 34621, 34622, 34628, 34629, 34630, 34631, 34632, 34639, 34640, 34642, 34643, 34647, 34667, 34671, 34673, 34675, 34678, 34679, 34807, 34808, 34809, 34810, 34811, 34812, 34813, 34814, 34815, 34816, 34817, 34818, 34819, 34820, 34821, 34822, 34823, 34956, 34957, 34958, 34959, 34960, 34961, 34965, 34966, 35079, 35080, 35081, 35082, 35083, 35084, 35085, 35086, 35087, 35113, 35124, 35125, 35126, 35143, 35214, 35215, 35216, 35217, 35218, 35219, 35224, 35225, 35226, 35230, 35237, 35238, 35239, 35240, 35241, 35242, 35249, 35250, 35259, 35264, 35298, 35299, 35300, 35301, 35302, 35306, 35308, 35309, 35310, 35328, 35329, 35330, 35331, 35338, 35339, 35340, 35343, 35344, 35345, 35348, 35349, 35350, 35351, 35354, 35355, 35356, 35357, 35358, 35359, 35360, 35361, 35368, 35369, 35370, 35373, 35374, 35375, 35376, 35377, 35378, 35379, 35383, 35384, 35385, 35442, 35443, 35444, 35445, 35448, 35449, 35450, 35451, 35547, 35548, 35549, 35553, 35554, 35555, 35557, 35558, 35600, 35601, 35602, 35618, 35619, 35620, 35631, 35632, 35633, 35635, 35636, 35637, 35645, 35646, 35647, 35665, 35670, 35671, 35672, 35673, 35674, 35675, 35680, 35682, 35683, 35684, 35685, 35686, 35687, 35688, 35689, 35690, 35691, 35692, 35693, 35694, 35695, 35696, 35697, 35698, 35699, 35700, 35703, 35704, 35705, 35706, 35707, 35708, 35711, 35712, 35716, 35717, 35718, 35719, 35720, 35721, 35722, 35723, 35724, 35725, 35726, 35727, 35728, 35729, 35730, 35731, 35732, 35733, 35734, 35735, 35736, 35737, 35738, 35739, 35740, 35741, 35742, 35743, 35744, 35745, 35746, 35747, 35748, 35749, 35750, 35751, 35752, 35753, 35754, 35755, 35758, 35762, 35763, 35764, 35765, 35766, 35767, 35768, 35769, 35770, 35771, 35772, 35773, 35774, 35775, 35776, 35777, 35778, 35779, 35780, 35783, 35784, 35785, 35786, 35790, 35791, 35792, 35795, 35796, 35797, 35798, 35799, 35800, 35801, 35802, 35803, 35804, 35805, 35806, 35807, 35808, 35809, 35810, 35811, 35812, 35813, 35814, 35815, 35816, 35817, 35818, 35819, 35820, 35826, 35827, 35830, 35831, 35832, 35833, 35838, 35839, 35840, 35841, 35843, 35847, 35848, 35849, 35850, 35851, 35852, 35853, 35854, 35856, 35857, 35858, 35859, 35860, 35861, 35865, 35866, 35867, 35868, 35869, 35870, 35871, 35872, 35873, 35874, 35875, 35876, 35877, 35878, 35879, 35880, 35881, 35882, 35883, 35884, 35885, 35886, 35887, 35888, 35889, 35890, 35891, 35892, 35893, 35894, 35895, 35896, 35897, 35898, 35899, 35900, 35901, 35902, 35903, 35904, 35905, 35906, 35907, 35908, 35909, 35910, 35911, 35912, 35913, 35914, 35915, 35916, 35917, 35918, 35919, 35920, 35921, 35922, 35923, 35924, 35925, 35926, 35927, 35928, 35929, 35930, 35931, 35932, 35933, 35934, 35935, 35936, 35937, 35938, 35939, 35940, 35941, 35942, 35943, 35944, 35945, 35946, 35947, 35948, 35949, 35950, 35951, 35952, 35953, 35954, 35955, 35956, 35957, 35958, 35959, 35960, 35961, 35962, 35963, 35964, 35965, 35966, 35967, 35968, 35969, 35970, 35971, 35972, 35973, 35974, 35975, 35976, 35977, 35978, 35979, 35980, 35981, 35982, 35983, 35984, 35985, 35986, 35987, 35988, 35989, 35990, 35991, 35992, 35993, 35994, 35995, 35996, 35997, 36001, 36003, 36004, 36005, 36006, 36007, 36008, 36009, 36010, 36011, 36013, 36014, 36015, 36016, 36017, 36021, 36022, 36023, 36031, 36032, 36036, 36037, 36042, 36043, 36044, 36045, 36046, 36047, 36049, 36050, 36051, 36052, 36056, 36057, 36058, 36085, 36086, 36154, 36155, 36194, 36277, 36286, 36294, 36295, 36296, 36298, 36300, 36301, 36302, 36303, 36304, 36305, 36306, 36307, 36308, 36309, 36310, 36317, 36318, 36319, 36320, 36321, 36322, 36323, 36324, 36325, 36326, 36327, 36329, 36330, 36331, 36332, 36333, 36334, 36335, 36336, 36337, 36338, 36339, 36340, 36341, 36342, 36343, 36344, 36345, 36346, 36347, 36348, 36349, 36350, 36351, 36352, 36353, 36354, 36355, 36356, 36357, 36358, 36359, 36360, 36361, 36362, 36363, 36364, 36365, 36366, 36367, 36368, 36369, 36370, 36371, 36372, 36373, 36374, 36375, 36376, 36377, 36378, 36379, 36380, 36381, 36382, 36383, 36384, 36385, 36386, 36387, 36388, 36389, 36390, 36392, 36393, 36394, 36396, 36399, 36400, 36401, 36407, 36413, 36414, 36415, 36416, 36417, 36418, 36419, 36420, 36421, 36422, 36423, 36424, 36425, 36426, 36427, 36428, 36429, 36433, 36434, 36435, 36436, 36437, 36439, 36440, 36441, 36443, 36446, 36448, 36449, 36450, 36451, 36452, 36453, 36454, 36455, 36456, 36457, 36458, 36459, 36460, 36461, 36462, 36463, 36464, 36465, 36469, 36470, 36472, 36473, 36474, 36475, 36476, 36477, 36478, 36480, 36481, 36482, 36483, 36484, 36485, 36486, 36487, 36488, 36489, 36490, 36491, 36492, 36493, 36494, 36495, 36496, 36497, 36498, 36499, 36500, 36501, 36502, 36503, 36504, 36505, 36506, 36507, 36509, 36510, 36511, 36512, 36513, 36514, 36515, 36516, 36517, 36518, 36519, 36520, 36521, 36522, 36524, 36526, 36530, 36531, 36532, 36533, 36534, 36536, 36537, 36540, 36541, 36542, 36543, 36547, 36548, 36549, 36550, 36551, 36552, 36553, 36555, 36556, 36557, 36558, 36559, 36561, 36562, 36563, 36564, 36565, 36566, 36567, 36568, 36569, 36570, 36571, 36572, 36573, 36574, 36575, 36576, 36577, 36578, 36579, 36580, 36582, 36583, 36584, 36585, 36586, 36587, 36588, 36589, 36590, 36591, 36592, 36593, 36594, 36595, 36596, 36597, 36598, 36599, 36600, 36601, 36602, 36603, 36604, 36605, 36606, 36607, 36608, 36609, 36610, 36611, 36612, 36613, 36614, 36615, 36616, 36617, 36618, 36619, 36620, 36621, 36622, 36623, 36624, 36625, 36626, 36627, 36628, 36629, 36630, 36631, 36632, 36633, 36634, 36635, 36636, 36637, 36638, 36639, 36672, 36673, 36674, 36680, 36681, 36682, 36683, 36684, 36685, 36709, 36710, 36711, 36712, 36713, 36714, 36715, 36716, 36717, 36718, 36719, 36720, 36721, 36722, 36723, 36724, 36725, 36726, 36727, 36728, 36729, 36730, 36731, 36732, 36733, 36734, 36735, 36736, 36737, 36738, 36739, 36740, 36741, 36742, 36743, 36744, 36745, 36746, 36747, 36748, 36749, 36750, 36751, 36752, 36753, 36754, 36755, 36756, 36757, 36758, 36759, 36760, 36761, 36762, 36763, 36764, 36765, 36766, 36767, 36768, 36769, 36770, 36831, 36832, 36833, 36834, 36835, 36836, 36837, 36838, 36839, 36840, 36841, 36842, 36843, 36844, 36845, 36846, 36847, 36848, 36849, 36850, 36851, 36852, 36853, 36854, 36855, 36856, 36857, 36858, 36859, 36860, 36861, 36862, 36863, 36864, 36865, 36866, 36867, 36868, 36869, 36870, 36871, 36872, 36873, 36874, 36875, 36876, 36877, 36878, 36879, 36880, 36881, 36886, 36896, 36897, 36898, 36899, 36900, 36914, 36915, 36916, 36917, 36918, 36919, 36920, 36921, 36933, 36934, 36935, 36936, 36937, 36938, 36939, 36940, 36941, 36942, 36943, 36944, 36945, 36946, 36951, 36952, 36956, 36957, 36958, 36964, 36965, 36972, 36973, 36974, 36975, 36976, 36977, 36978, 36979, 36980, 36981, 36982, 36983, 36984, 36985, 36986, 37006, 37007, 37008, 37009, 37010, 37011, 37012, 37013, 37014]

    # add_pinned_verts(garments_dict_path, garment_name, pinned_indices)


    # Set material paramenters, see configs/cvpr.yaml for the training ranges for each parameter
    config_dict = dict()
    config_dict['density'] = 0.20022
    config_dict['lame_mu'] = 23600.0
    config_dict['lame_lambda'] = 44400
    config_dict['bending_coeff'] = 3.962e-05

    # If True, the SMPL poses are slightly modified to avoid hand-body self-penetrations. The technique is adopted from the code of SNUG 
    config_dict['separate_arms'] = True

    # Paths to SMPL model and garments_dict file relative to $HOOD_DATA/aux_data
    config_dict['garment_dict_file'] = 'garments_dict.pkl'
    config_dict['smpl_model'] = 'smpl/SMPL_FEMALE.pkl'

    validation_config = ValidationConfig(**config_dict)


    # Choose the model and the configuration file

    # config_name = 'cvpr_baselines/fine15'
    # checkpoint_path = Path(DEFAULTS.data_root) / 'trained_models' / 'fine15.pth'

    # config_name = 'cvpr_baselines/fine48'
    # checkpoint_path = Path(DEFAULTS.data_root) / 'trained_models' / 'fine48.pth'

    # config_name = 'cvpr'
    # checkpoint_path = Path(DEFAULTS.data_root) / 'trained_models' / 'cvpr_submission.pth'

    config_name = 'postcvpr'
    checkpoint_path = Path(DEFAULTS.data_root) / 'trained_models' / 'postcvpr.pth'

    # load the config from .yaml file and load .py modules specified there
    modules, experiment_config = load_params(config_name)

    # modify the config to use it in validation 
    experiment_config = update_config_for_validation(experiment_config, validation_config)

    # load Runner object and the .py module it is declared in
    runner_module, runner = load_runner_from_checkpoint(checkpoint_path, modules, experiment_config)

    # file with the pose sequence
    sequence_path =  Path(HOOD_DATA) / 'temp/01_01.pkl'


    # name of the garment to sumulate
    garment_name = 'shorts'

    dataloader = create_one_sequence_dataloader(sequence_path, garment_name, modules, experiment_config)

    sequence = next(iter(dataloader))
    sequence = move2device(sequence, 'cuda:0')
    trajectories_dict = runner.valid_rollout(sequence,  bare=True)

    print(f"trajectories_dict {trajectories_dict}")
    

    # Save the sequence to disc
    out_path = Path(DEFAULTS.data_root) / 'temp' / 'output.pkl'
    print(f"Rollout saved into {out_path}")
    pickle_dump(dict(trajectories_dict), out_path)

    # Careful!: creating more that one renderer in a single session causes an error
    renderer = HeadlessRenderer()

    out_path = Path(DEFAULTS.data_root) / 'temp' / 'output.pkl'
    out_video = Path(DEFAULTS.data_root) / 'temp' / 'output.mp4'

    out_objs = Path(DEFAULTS.data_root) / 'temp' / 'objs' /  garment_name 
    write_video(out_path, out_video, renderer, out_objs)
        


if __name__ == "__main__":
    main()